{% extends 'myapp/base.html' %}
{% load static %}
{% block content %}
<style>
	.table-responsive { overflow-x: auto; }
	/* Thumbnail sizing: constrain to column and keep aspect ratio */
	.id-thumb { display: inline-block; width: 40px; height:40px; max-width: 100%; max-height: 64px; object-fit: cover; }
	/* Reserve a narrow fixed column for the image so it doesn't expand */
	#dataTable td:first-child, #dataTable th:first-child { width: 80px; text-align: center; padding: 4px 6px; }
	/* Reduce image margin so it sits nearer the cell edge */
	.id-thumb { margin: 0; }
	/* Prevent most columns from wrapping so long text stays on one line and table can scroll horizontally */
	.table td, .table th { vertical-align: middle; white-space: nowrap; }
	/* Allow wrapping only for address column and limit its width */
	.wrap-col { max-width: 420px; white-space: normal; word-break: break-word; }
	/* Ensure table has a larger minimum width so columns have room */
	#dataTable { min-width: 1300px; }
</style>

<div class="card shadow mb-4">
	<div class="card-header py-3 d-flex justify-content-between align-items-center">
		<h6 class="m-0 font-weight-bold text-primary">ID Cards</h6>
	<!-- Button to trigger modal -->
	<button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addIdCardModal">
    <i class="fas fa-plus"></i> Add ID Card
</button>


	</div>
	<div class="card-body">
		<div class="table-responsive">
			<table class="table table-bordered table-hover" id="dataTable" width="100%" cellspacing="0">
				<thead>
					<tr>
						<th>Image</th>
						<th>ID Number</th>
						<th>Name</th>
						<th>Gender</th>
						<th>Date of Birth</th>
						<th>Address</th>
						<th>OR No</th>
						<th>Height (cm)</th>
						<th>Weight (kg)</th>
						<th>Date Issued</th>
						<th>Expiry Date</th>
					</tr>
          
				</thead>
				<tfoot>
					<tr>
						<th>Image</th>
						<th>ID Number</th>
						<th>Name</th>
						<th>Gender</th>
						<th>Date of Birth</th>
						<th>Address</th>
						<th>OR No</th>
						<th>Height (cm)</th>
						<th>Weight (kg)</th>
						<th>Date Issued</th>
						<th>Expiry Date</th>
					</tr>

          
				</tfoot>
				<tbody>
					{% for card in cards %}
					<tr>
						<td>
							{% if card.image %}
								<img src="{{ card.image.url }}" alt="{{ card.name }}" class="id-thumb">
							{% else %}
								<span class="text-muted">-</span>
							{% endif %}
						</td>
						<td>{{ card.id_number }}</td>
						<td>{{ card.name }}</td>
						<td>{{ card.get_gender_display }}</td>
						<td>{{ card.date_of_birth }}</td>
						<td class="wrap-col">{{ card.address }}</td>
						<td>{{ card.or_number }}</td>
						<td>{{ card.height }}</td>
						<td>{{ card.weight }}</td>
						<td>{{ card.date_issued }}</td>
						<td>{{ card.expiration_date }}</td>
					</tr>
					{% empty %}
					<tr>
						<td colspan="11" class="text-center text-muted">No ID cards found.</td>
					</tr>
					{% endfor %}
				</tbody>
			</table>
		</div>
	</div>
</div>

<!-- Add ID Card Modal -->
<div class="modal fade" id="addIdCardModal" tabindex="-1" role="dialog">
  <div class="modal-dialog modal-lg" role="document"> <!-- WIDER modal -->
    <div class="modal-content">

      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Add ID Card</h5>
        <button type="button" class="close text-white" data-dismiss="modal">
          <span>&times;</span>
        </button>
      </div>

      <div class="modal-body">

        <form id="idCardForm" enctype="multipart/form-data">
          {% csrf_token %}

          <div class="row">

            <!-- LEFT COLUMN -->
            <div class="col-md-6">

              <div class="form-group">
                <label>Name</label>
                <input name="name" class="form-control" required>
              </div>

              <div class="form-group">
                <label>Address</label>
                <textarea name="address" class="form-control" required></textarea>
              </div>

              <div class="form-group">
                <label>ID Number</label>
                <input name="id_number" class="form-control" required>
              </div>

              <div class="form-group">
                <label>Date of Birth</label>
                <input type="date" name="date_of_birth" class="form-control">
              </div>

              <div class="form-group">
                <label>Gender</label>
                <select name="gender" class="form-control">
                  <option value="M">Male</option>
                  <option value="F">Female</option>
                  <option value="O">Other</option>
                </select>
              </div>

            </div>

            <!-- RIGHT COLUMN -->
            <div class="col-md-6">

              <div class="form-group">
                <label>OR Number</label>
                <input name="or_number" class="form-control">
              </div>

              <div class="form-group">
                <label>Height (cm)</label>
                <input name="height" class="form-control" type="number" step="0.01">
              </div>

              <div class="form-group">
                <label>Weight (kg)</label>
                <input name="weight" class="form-control" type="number" step="0.01">
              </div>

              <div class="form-group">
                <label>Date Issued</label>
                <input type="date" name="date_issued" class="form-control">
              </div>

              <div class="form-group">
                <label>Expiration Date</label>
                <input type="date" name="expiration_date" class="form-control">
              </div>

              <div class="form-group">
                <label>Photo</label>
                <input type="file" name="image" class="form-control" required>
              </div>

            </div>

          </div>
        </form>

      </div>

      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="saveIdCardBtn">
          <i class="fas fa-save"></i> Save
        </button>
      </div>

    </div>
  </div>
</div>



<!-- Optional: JS for handling frontend save (just console log for now) -->
<script>
document.getElementById('saveIdCardBtn').addEventListener('click', function() {
    const name = document.getElementById('idCardName').value;
    const number = document.getElementById('idCardNumber').value;
    console.log("ID Card Data:", {name, number});
    $('#addIdCardModal').modal('hide'); // Bootstrap 4 way
});

document.getElementById("saveIdCardBtn").addEventListener("click", function () {
    let form = document.getElementById("idCardForm");
    let formData = new FormData(form);

    fetch("{% url 'add-idcard' %}", {
        method: "POST",
        body: formData,
        headers: {
            "X-CSRFToken": "{{ csrf_token }}",
        }
    })
    .then(response => {
        if (response.ok) {
            // Close modal
            $('#addIdCardModal').modal('hide');

            // Reload the page to show Django messages
            setTimeout(() => {
                location.reload();
            }, 300);
        }
    })
    .catch(err => console.error(err));
});
</script>


{% endblock %}